{% extends 'base.html' %}

{% block title %}Игровое поле{% endblock %}

{% block app_content %}
  <div class="game-header">
        <!-- Счётчик поколений -->
        <div class="generation-counter">
            Поколение: {{ game.generation }}
        </div>
        <div class="game-status">
            {% if game_over_message %}
                <div class="game-over">{{ game_over_message }}</div>
            {% else %}
                <div class="game-active">Игра продолжается</div>
            {% endif %}
        </div>
        <!-- отображение пользовательского размера -->
        <div class="world-info">
            Размер: {{ game.get_width() }}x{{ game.get_height() }}
        </div>
  </div>

  <a href="{{ url_for('index') }}" class="btn btn-warning home">На главную страницу</a>
  <!--  полный цикл перезапуска игры через новый метод сброса -->
  <a href="{{ url_for('reset') }}" class="btn btn-info refresh">Новая игра</a>


  

  <table class="world">
    {% for i in range(game.get_height()) %}
      <tr>
        {% for j in range(game.get_width()) %}
        <!-- Клетка осталась живой -->
          {% if game.world[i][j] == 1 %}
            <td class="cell living-cell"></td>
            <!-- Умершая клетка -->
          {% elif game.old_world[i][j] == 1%}
          <!-- Добавлено отображение умерших -->  
            <td class="cell dead-cell"</td>          
          <!-- Клетка осталась мертвой -->
          {% else %}
            <td class="cell"></td>
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </table>

{% if game_over_message %}
    <div class="restart-prompt">
        <a href="{{ url_for('index') }}" class="btn btn-success">
            Начать новую игру
        </a>
    </div>
    
{% endif %}

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        
        socket.on('connect', function() {
            console.log("Connected to WebSocket");
        });
        
        socket.on('game_update', function(data) {
            updateGameUI(data);
            
            if (!data.game_over) {
                setTimeout(() => {
                    socket.emit('next_generation');
                }, 1000);
            }
        });
        
        // Функция updateGameUI остается без изменений
        
        // Запуск игры
        $(document).ready(function() {
            // Принудительно запрашиваем первое состояние
            socket.emit('next_generation');
        });
    </script>
{% endblock %}